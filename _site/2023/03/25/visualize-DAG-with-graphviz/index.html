<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Visualize DAG with Graphviz &middot; Asurin
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/lanyon.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
    
  <!-- Lightbox -->
  <script src="/public/js/jquery.min.js"></script>
  <style>
.lightbox {width: 100%; height: 100%; position: fixed; top: 0; left: 0; background: rgba(0,0,0,0.85); z-index: 9999999; line-height: 0; cursor: pointer;}
.lightbox .img {
	position: relative;
	top: 50%;
	left: 50%;
	-ms-transform: translateX(-50%) translateY(-50%);
	-webkit-transform: translate(-50%,-50%);
	transform: translate(-50%,-50%);
	max-width: 100%;
	max-height: 100%;
}
.lightbox .img img {opacity: 0; pointer-events: none; width: auto;}
@media screen and (min-width: 1200px) {
    .lightbox .img {
		max-width: 1200px;
    }
}
@media screen and (min-height: 1200px) {
    .lightbox img {
		max-height: 1200px;
	}
}
.lightbox span {
		display: block;
		position: fixed;
		bottom: 13px;
		height: 1.5em;
		line-height: 1.4em;
		width: 100%;
		text-align: center;
		color: white;
		text-shadow:
    -1px -1px 0 #000,
    1px -1px 0 #000,
    -1px 1px 0 #000,
    1px 1px 0 #000;
}






.lightbox .videoWrapperContainer {
	position: relative;
	top: 50%;
	left: 50%;
	-ms-transform: translateX(-50%) translateY(-50%);
	-webkit-transform: translate(-50%,-50%);
	transform: translate(-50%,-50%);
	max-width: 900px;
	max-height: 100%;
}
.lightbox .videoWrapperContainer .videoWrapper {
	height: 0;
	line-height: 0;
	margin: 0;
	padding: 0;
	position: relative;
	padding-bottom: 56.333%; /* custom */
	background: black;
}
.lightbox .videoWrapper iframe {
	position: absolute;
	top: 0;
	left: 0;
	width: 100%;
	height: 100%;
	border: 0;
	display: block;
}
.lightbox #prev, .lightbox #next {height: 50px; line-height: 36px; display: none; margin-top: -25px; position: fixed; top: 50%; padding: 0 15px; cursor: pointer; text-decoration: none; z-index: 99; color: white; font-size: 60px;}
.lightbox.gallery #prev, .lightbox.gallery #next {display: block;}
.lightbox #prev {left: 0;}
.lightbox #next {right: 0;}
.lightbox #close {height: 50px; width: 50px; position: fixed; cursor: pointer; text-decoration: none; z-index: 99; right: 0; top: 0;}
.lightbox #close:after, .lightbox #close:before {position: absolute; margin-top: 22px; margin-left: 14px; content: ""; height: 3px; background: white; width: 23px;
-webkit-transform-origin: 50% 50%;
-moz-transform-origin: 50% 50%;
-o-transform-origin: 50% 50%;
transform-origin: 50% 50%;
/* Safari */
-webkit-transform: rotate(-45deg);
/* Firefox */
-moz-transform: rotate(-45deg);
/* IE */
-ms-transform: rotate(-45deg);
/* Opera */
-o-transform: rotate(-45deg);
}
.lightbox #close:after {
/* Safari */
-webkit-transform: rotate(45deg);
/* Firefox */
-moz-transform: rotate(45deg);
/* IE */
-ms-transform: rotate(45deg);
/* Opera */
-o-transform: rotate(45deg);
}
.lightbox, .lightbox * {
  -webkit-touch-callout: none; /* iOS Safari */
    -webkit-user-select: none; /* Safari */
     -khtml-user-select: none; /* Konqueror HTML */
       -moz-user-select: none; /* Old versions of Firefox */
        -ms-user-select: none; /* Internet Explorer/Edge */
            user-select: none; /* Non-prefixed version, currently
                                  supported by Chrome, Opera and Firefox */}
}
</style>

<script>
function is_youtubelink(url) {
  var p = /^(?:https?:\/\/)?(?:www\.)?(?:youtu\.be\/|youtube\.com\/(?:embed\/|v\/|watch\?v=|watch\?.+&v=))((\w|-){11})(?:\S+)?$/;
  return (url.match(p)) ? RegExp.$1 : false;
}
function is_imagelink(url) {
	var p = /([a-z\-_0-9\/\:\.]*\.(jpg|jpeg|png|gif))/i;
	return (url.match(p)) ? true : false;
}
function is_vimeolink(url,el) {
	var id = false;
	$.ajax({
	  url: 'https://vimeo.com/api/oembed.json?url='+url,
	  async: true,
	  success: function(response) {
		if(response.video_id) {
		  id = response.video_id;
		  $(el).addClass('lightbox-vimeo').attr('data-id',id);
		}
	  }
	});
}

$(document).ready(function() {
	//add classes to links to be able to initiate lightboxes
	$("a").each(function(){
		var url = $(this).attr('href');
		if(url) {
			if(url.indexOf('vimeo') !== -1 && !$(this).hasClass('no-lightbox')) is_vimeolink(url,$(this));
			if(is_youtubelink(url) && !$(this).hasClass('no-lightbox')) $(this).addClass('lightbox-youtube').attr('data-id',is_youtubelink(url));
			if(is_imagelink(url) && !$(this).hasClass('no-lightbox')) {
				$(this).addClass('lightbox-image');
				var href = $(this).attr('href');
				var filename = href.split('/').pop();
				var split = filename.split(".");
				var name = split[0];
				$(this).attr('title',name);
			}
		}
	});
	//remove the clicked lightbox
	$("body").on("click", ".lightbox", function(event){
		if($(this).hasClass('gallery')) {

			$(this).remove();

			if($(event.target).attr('id')=='next') {
				//next item
				if($("a.gallery.current").nextAll("a.gallery:first").length) $("a.gallery.current").nextAll("a.gallery:first").click();
				else $("a.gallery.current").parent().find("a.gallery").first().click();
			}
			else if ($(event.target).attr('id')=='prev') {
				//prev item
				if($("a.gallery.current").prevAll("a.gallery:first").length) $("a.gallery.current").prevAll("a.gallery:first").click();
				else $("a.gallery.current").parent().find("a.gallery").last().click();
			}
			else {
				$("a.gallery").removeClass('gallery');
			}
		}
		else $(this).remove();
	});
	//prevent image from being draggable (for swipe)
	$("body").on('dragstart', ".lightbox img", function(event) { event.preventDefault(); });
	//add the youtube lightbox on click
	$("a.lightbox-youtube").click(function(event){
		event.preventDefault();
		$('<div class="lightbox"><a id="close"></a><a id="next">&rsaquo;</a><a id="prev">&lsaquo;</a><div class="videoWrapperContainer"><div class="videoWrapper"><iframe src="https://www.youtube.com/embed/'+$(this).attr('data-id')+'?autoplay=1&showinfo=0&rel=0"></iframe></div></div></div>').appendTo('body');
	});
	//add the image lightbox on click
	$("a.lightbox-image").click(function(event){
		event.preventDefault();
		$('<div class="lightbox"><a id="close"></a><a id="next">&rsaquo;</a><a id="prev">&lsaquo;</a><div class="img" style="background: url(\''+$(this).attr('href')+'\') center center / contain no-repeat;" title="'+$(this).attr('title')+'" ><img src="'+$(this).attr('href')+'" alt="'+$(this).attr('title')+'" /></div><span>'+$(this).attr('title')+'</span></div>').appendTo('body');
	});
	//add the vimeo lightbox on click
	$("body").on("click", "a.lightbox-vimeo", function(event){
		event.preventDefault();
		$('<div class="lightbox"><a id="close"></a><a id="next">&rsaquo;</a><a id="prev">&lsaquo;</a><div class="videoWrapperContainer"><div class="videoWrapper"><iframe src="https://player.vimeo.com/video/'+$(this).attr('data-id')+'/?autoplay=1&byline=0&title=0&portrait=0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe></div></div></div>').appendTo('body');
	});

	$("body").on("click", "a[class*='lightbox-']", function(){
		var link_elements = $(this).parent().find("a[class*='lightbox-']");
		$(link_elements).removeClass('current');
		for (var i=0; i<link_elements.length; i++) {
			if($(this).attr('href') == $(link_elements[i]).attr('href')) {
				$(link_elements[i]).addClass('current');
			}
		}
		if(link_elements.length>1) {
			$('.lightbox').addClass('gallery');
			$(link_elements).addClass('gallery');
		}
	});


});

$(document).keydown(function(e) {
    switch(e.which) {
        case 37: // left
        $("#prev").click();
        break;
        case 39: // right
        $("#next").click();
        break;
	case 27: // esc
        $("#close").click();
        break;
        default: return; // exit this handler for other keys
    }
    e.preventDefault(); // prevent the default action (scroll / move caret)
});



  /*===========================
  Swipe-it v1.4.1
  An event listener for swiping gestures with vanilla js.
  https://github.com/tri613/swipe-it#readme

  @Create 2016/09/22
  @Update 2017/08/11
  @Author Trina Lu
  ===========================*/

  "use strict";var _slicedToArray=function(){function n(n,t){var e=[],i=!0,o=!1,r=void 0;try{for(var u,c=n[Symbol.iterator]();!(i=(u=c.next()).done)&&(e.push(u.value),!t||e.length!==t);i=!0);}catch(n){o=!0,r=n}finally{try{!i&&c.return&&c.return()}finally{if(o)throw r}}return e}return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return n(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();!function(n,t,e){function i(n){function e(){o("touchstart",m,w),o("touchmove",d,w),o("touchend",p,w),E.mouseEvent&&o("mousedown",s,w)}function i(){y=!1,D=!1,A=!1,b=!1,a=!1}function s(n){a=this,y=n.clientX,D=n.clientY,o("mousemove",l,v),o("mouseup",h,v)}function l(n){n.preventDefault(),y&&D&&(A=n.clientX,b=n.clientY)}function h(n){r("mousemove",l,v),r("mouseup",h,v),p(n)}function m(n){a=this,y=n.touches[0].clientX,D=n.touches[0].clientY}function d(n){A=n.touches[0].clientX,b=n.touches[0].clientY}function p(n){if(y&&D&&A&&b){var t=y-A,e=D-b,o=[t,e].map(Math.abs),r=_slicedToArray(o,2),c=r[0],s=r[1],v=E.minDistance;if(c>v){var f=y<A?"swipeRight":"swipeLeft";u(f,a,{distance:t,start:y,end:A})}if(s>v){var l=D>b?"swipeUp":"swipeDown";u(l,a,{distance:e,start:D,end:b})}(c>v||s>v)&&u("swipe",a)}i()}var E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},w=c(t.querySelectorAll(n)),y=void 0,D=void 0,A=void 0,b=void 0;E.mouseEvent=void 0===E.mouseEvent?f.mouseEvent:E.mouseEvent,E.minDistance=void 0===E.minDistance?f.minDistance:E.minDistance,i(),e(),this.on=function(n,t){return o(n,t,w),this}}function o(n,t,e){s(e).forEach(function(e){return e.addEventListener(n,t)})}function r(n,t,e){s(e).forEach(function(e){return e.removeEventListener(n,t)})}function u(n,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=t.createEvent("Event");o.initEvent(n,!0,!0),o.swipe=i,s(e).forEach(function(n){return n.dispatchEvent(o)})}function c(n){for(var t=[],e=0;e<n.length;e++)t.push(n[e]);return t}function s(n){return Array.isArray(n)?n:[n]}var a=!1,v=[n],f={mouseEvent:!0,minDistance:30};n[e]=i}(window,document,"SwipeIt");

var mySwipeIt = new SwipeIt('body');
mySwipeIt.on('swipeLeft',function(e){
	//check if lightbox is present
	if($('.lightbox').length >  0 ) {
		$("#next").click();
	}
}).on('swipeRight',function(e){
	//check if lightbox is present
	if($('.lightbox').length >  0 ) {
		$("#prev").click();
	}
});

</script>

</head>


  <body class="theme-base-08">

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p>Asurin <br /> Software Developer <br /></p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item" href="/">Home</a>

    

    
    
      
        
      
    
      
        
      
    
      
        
          <a class="sidebar-nav-item" href="/about/">About Me</a>
        
      
    
      
    
      
        
          <a class="sidebar-nav-item" href="/niuniu/">Niu Niu</a>
        
      
    
      
        
      
    
      
        
      
    


  </nav>

  <div class="sidebar-item">
    <p>
      &copy; 2023. All rights reserved.
    </p>
  </div>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">Asurin</a>
            <small>Software Developer</small>
          </h3>
        </div>
      </div>

      <div class="container content">
        <div class="post">
  <h1 class="post-title">Visualize DAG with Graphviz</h1>
  <span class="post-date">25 Mar 2023</span>
  <p>At GDC, we have a graph saved in database. The structure of the graph is defined with <a href="https://github.com/NCI-GDC/gdcdictionary/">GDCDictioanry</a>. 
To write tests for our softwares, we need to create and load fake data in our test database. The fake data is usually in yaml
format. With complicated test cases, we will need many nodes and edges in the test data. It will be hard to create or modify those fake data. 
<!--break--></p>

<p><img src="/images/graphviz_gdc/gdcdictionary.png" alt="gdcdictionary" /></p>

<figure class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="nn">---</span>
<span class="na">nodes</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">label</span><span class="pi">:</span> <span class="s">case</span>
    <span class="na">node_id</span><span class="pi">:</span> <span class="s">ee327e98-a722-4609-a9ff-e1da88169b3e</span>
    <span class="na">submitter_id</span><span class="pi">:</span> <span class="s">case_1</span>
  <span class="pi">-</span> <span class="na">label</span><span class="pi">:</span> <span class="s">sample</span>
    <span class="na">submitter_id</span><span class="pi">:</span> <span class="s">sample_1</span>
    <span class="na">tissue_type</span><span class="pi">:</span> <span class="s">Normal</span>
    <span class="na">sample_type</span><span class="pi">:</span> <span class="s">Blood Derived Normal</span>
  <span class="pi">-</span> <span class="na">label</span><span class="pi">:</span> <span class="s">portion</span>
    <span class="na">submitter_id</span><span class="pi">:</span> <span class="s">portion_1</span>
  <span class="pi">-</span> <span class="na">label</span><span class="pi">:</span> <span class="s">analyte</span>
    <span class="na">submitter_id</span><span class="pi">:</span> <span class="s">analyte_1</span>
  <span class="pi">-</span> <span class="na">label</span><span class="pi">:</span> <span class="s">aliquot</span>
    <span class="na">node_id</span><span class="pi">:</span> <span class="s">1f8557c3-33a3-4fca-b7d1-2464f14c9514</span>
    <span class="na">submitter_id</span><span class="pi">:</span> <span class="s">aliquot_1</span>
    <span class="na">no_matched_normal_wxs</span><span class="pi">:</span> <span class="kc">false</span>
    <span class="na">no_matched_normal_targeted_sequencing</span><span class="pi">:</span> <span class="kc">false</span>
    <span class="na">selected_normal_wxs</span><span class="pi">:</span> <span class="kc">true</span>
    <span class="na">analyte_type</span><span class="pi">:</span> <span class="s">DNA</span>
    <span class="na">selected_normal_targeted_sequencing</span><span class="pi">:</span> <span class="kc">false</span>
  <span class="pi">-</span> <span class="na">label</span><span class="pi">:</span> <span class="s">read_group</span>
    <span class="na">node_id</span><span class="pi">:</span> <span class="s">dfbdabb5-5d9e-442a-a9ac-eea5132324ed</span>
    <span class="na">submitter_id</span><span class="pi">:</span> <span class="s">rg_1</span>
    <span class="na">single_cell_library</span><span class="pi">:</span> <span class="s">Chromium 3' Gene Expression v3 Library</span>
    <span class="na">target_capture_kit</span><span class="pi">:</span> <span class="s">SureSelect Human All Exon v5</span>
  <span class="pi">-</span> <span class="na">label</span><span class="pi">:</span> <span class="s">read_group</span>
    <span class="na">node_id</span><span class="pi">:</span> <span class="s">2c560954-d0d0-4d35-9c44-24e483059697</span>
    <span class="na">submitter_id</span><span class="pi">:</span> <span class="s">rg_2</span>
    <span class="na">single_cell_library</span><span class="pi">:</span> <span class="s">Chromium 3' Gene Expression v3 Library</span>
  <span class="pi">-</span> <span class="na">label</span><span class="pi">:</span> <span class="s">submitted_unaligned_reads</span>
    <span class="na">node_id</span><span class="pi">:</span> <span class="s">57261c6c-918d-4b71-b96c-80db0024fa7a</span>
    <span class="na">submitter_id</span><span class="pi">:</span> <span class="s">sur_1</span>
    <span class="na">experimental_strategy</span><span class="pi">:</span> <span class="s">m6A MeRIP-Seq</span>
<span class="na">edges</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">src</span><span class="pi">:</span> <span class="s">sample_1</span>
    <span class="na">dst</span><span class="pi">:</span> <span class="s">case_1</span>
    <span class="na">label</span><span class="pi">:</span> <span class="s">cases</span>
  <span class="pi">-</span> <span class="na">src</span><span class="pi">:</span> <span class="s">portion_1</span>
    <span class="na">dst</span><span class="pi">:</span> <span class="s">sample_1</span>
    <span class="na">label</span><span class="pi">:</span> <span class="s">samples</span>
  <span class="pi">-</span> <span class="na">src</span><span class="pi">:</span> <span class="s">analyte_1</span>
    <span class="na">dst</span><span class="pi">:</span> <span class="s">portion_1</span>
    <span class="na">label</span><span class="pi">:</span> <span class="s">portions</span>
  <span class="pi">-</span> <span class="na">src</span><span class="pi">:</span> <span class="s">aliquot_1</span>
    <span class="na">dst</span><span class="pi">:</span> <span class="s">analyte_1</span>
    <span class="na">label</span><span class="pi">:</span> <span class="s">analytes</span>
  <span class="pi">-</span> <span class="na">src</span><span class="pi">:</span> <span class="s">rg_1</span>
    <span class="na">dst</span><span class="pi">:</span> <span class="s">aliquot_1</span>
    <span class="na">label</span><span class="pi">:</span> <span class="s">aliquots</span>
  <span class="pi">-</span> <span class="na">src</span><span class="pi">:</span> <span class="s">rg_2</span>
    <span class="na">dst</span><span class="pi">:</span> <span class="s">aliquot_1</span>
    <span class="na">label</span><span class="pi">:</span> <span class="s">aliquots</span>
  <span class="pi">-</span> <span class="na">src</span><span class="pi">:</span> <span class="s">sur_1</span>
    <span class="na">dst</span><span class="pi">:</span> <span class="s">rg_1</span>
    <span class="na">label</span><span class="pi">:</span> <span class="s">read_groups</span></code></pre></figure>

<p>To help us with large test data, we should visualize the test data. It is much easier to understand the relationships with charts than reading
a yaml file. <a href="https://graphviz.org/">Graphviz</a> is an opensource graph visualization software. Which is very helpful in our case.</p>

<p>To visualize our test data, I wrote a script to use graphviz to create a chart for it. And my colleague Rowland add color to
the graph so different node types will have different colors.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="n">json</span>
<span class="kn">import</span> <span class="n">os</span>
<span class="kn">import</span> <span class="n">uuid</span>
<span class="kn">from</span> <span class="n">functools</span> <span class="kn">import</span> <span class="n">lru_cache</span>
<span class="kn">from</span> <span class="n">typing</span> <span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span>

<span class="kn">import</span> <span class="n">requests</span>
<span class="kn">import</span> <span class="n">yaml</span>
<span class="kn">from</span> <span class="n">graphviz</span> <span class="kn">import</span> <span class="n">Digraph</span>

<span class="k">def</span> <span class="nf">draw</span><span class="p">(</span><span class="n">nodes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]],</span> <span class="n">edges</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]],</span> <span class="n">reverse</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="n">dot</span> <span class="o">=</span> <span class="nc">Digraph</span><span class="p">(</span><span class="s">'g'</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s">'btree.gv'</span><span class="p">,</span>
        <span class="n">node_attr</span><span class="o">=</span><span class="p">{</span><span class="s">'shape'</span><span class="p">:</span> <span class="s">'record'</span><span class="p">})</span>

    <span class="n">node_id_to_submitter_id</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
        <span class="n">submitter_id</span> <span class="o">=</span> <span class="n">node</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="s">"submitter_id"</span><span class="p">)</span>
        <span class="n">node_id</span> <span class="o">=</span> <span class="n">node</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="s">"node_id"</span><span class="p">)</span>
        <span class="n">suffix</span> <span class="o">=</span> <span class="sa">f</span><span class="s">"：</span><span class="si">{</span><span class="n">node</span><span class="p">[</span><span class="s">'gencode_version'</span><span class="p">]</span><span class="si">}</span><span class="s">"</span> <span class="k">if</span> <span class="n">node</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="s">"gencode_version"</span><span class="p">)</span> <span class="k">else</span> <span class="s">''</span>

        <span class="k">if</span> <span class="n">submitter_id</span> <span class="ow">and</span> <span class="n">node_id</span><span class="p">:</span>
            <span class="n">node_id_to_submitter_id</span><span class="p">[</span><span class="n">node_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">submitter_id</span> <span class="o">+</span> <span class="n">suffix</span>
        <span class="k">elif</span> <span class="n">submitter_id</span><span class="p">:</span>
            <span class="n">node_id_to_submitter_id</span><span class="p">[</span><span class="n">submitter_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">submitter_id</span> <span class="o">+</span> <span class="n">suffix</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">node_id_to_submitter_id</span><span class="p">[</span><span class="n">node_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">node_id</span> <span class="o">+</span> <span class="n">suffix</span>

    <span class="nf">print</span><span class="p">(</span><span class="n">node_id_to_submitter_id</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
        <span class="n">n_id</span> <span class="o">=</span> <span class="n">node_id_to_submitter_id</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">node</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="s">"node_id"</span><span class="p">)</span> <span class="ow">or</span> <span class="n">node</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="s">"submitter_id"</span><span class="p">))</span>
        <span class="c1"># print(n_id, node.get("submitter_id"), node.get("node_id"))
</span>        <span class="n">dot</span><span class="p">.</span><span class="nf">node</span><span class="p">(</span><span class="n">n_id</span><span class="p">,</span> <span class="n">fillcolor</span><span class="o">=</span><span class="nf">get_color</span><span class="p">(</span><span class="n">node</span><span class="p">[</span><span class="s">"label"</span><span class="p">]),</span> <span class="n">style</span><span class="o">=</span><span class="s">"filled"</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">edges</span><span class="p">:</span> 
        <span class="n">src</span> <span class="o">=</span> <span class="n">node_id_to_submitter_id</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">edge</span><span class="p">[</span><span class="s">"src"</span><span class="p">])</span> <span class="ow">or</span> <span class="n">edge</span><span class="p">[</span><span class="s">"src"</span><span class="p">]</span>
        <span class="n">dst</span> <span class="o">=</span> <span class="n">node_id_to_submitter_id</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">edge</span><span class="p">[</span><span class="s">"dst"</span><span class="p">])</span> <span class="ow">or</span> <span class="n">edge</span><span class="p">[</span><span class="s">"dst"</span><span class="p">]</span>
        <span class="c1"># print(src, dst, edge['src'], edge['dst'])
</span>        <span class="k">if</span> <span class="n">reverse</span><span class="p">:</span>
            <span class="n">dot</span><span class="p">.</span><span class="nf">edge</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">src</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dot</span><span class="p">.</span><span class="nf">edge</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">dot</span>


<span class="k">def</span> <span class="nf">draw_yaml</span><span class="p">(</span><span class="n">yaml_raw</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">yaml_dict</span> <span class="o">=</span> <span class="n">yaml</span><span class="p">.</span><span class="nf">load</span><span class="p">(</span><span class="n">yaml_raw</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">yaml</span><span class="p">.</span><span class="n">scanner</span><span class="p">.</span><span class="n">ScannerError</span><span class="p">:</span>
        <span class="n">yaml_dict</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="nf">loads</span><span class="p">(</span><span class="n">yaml_raw</span><span class="p">)</span>

    <span class="k">return</span> <span class="nf">draw</span><span class="p">(</span><span class="n">yaml_dict</span><span class="p">[</span><span class="s">'nodes'</span><span class="p">],</span> <span class="n">yaml_dict</span><span class="p">[</span><span class="s">'edges'</span><span class="p">])</span>


<span class="k">def</span> <span class="nf">draw_url</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">status_code</span><span class="p">)</span>
    <span class="k">return</span> <span class="nf">draw_yaml</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">content</span><span class="p">)</span>



<span class="nd">@lru_cache</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="mi">256</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">get_color</span><span class="p">(</span><span class="n">label</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="n">label</span> <span class="o">=</span> <span class="nf">str</span><span class="p">(</span><span class="n">uuid</span><span class="p">.</span><span class="nf">uuid5</span><span class="p">(</span><span class="n">UUID_NAMESPACE</span><span class="p">,</span> <span class="n">label</span><span class="p">))</span>
    <span class="n">label_color</span> <span class="o">=</span> <span class="nf">hex</span><span class="p">(</span><span class="nf">int</span><span class="p">(</span><span class="s">""</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="nf">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nf">map</span><span class="p">(</span><span class="nb">ord</span><span class="p">,</span> <span class="n">label</span><span class="p">))))</span> <span class="o">&amp;</span> <span class="mh">0x00FFFFFF</span><span class="p">)</span>
    <span class="k">return</span> <span class="s">"#{:f&lt;6}"</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">label_color</span><span class="p">[</span><span class="mi">2</span><span class="p">:])</span>


<span class="n">UUID_NAMESPACE_SEED</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="nf">getenv</span><span class="p">(</span><span class="s">"UUID_NAMESPACE_SEED"</span><span class="p">,</span> <span class="s">"f0d2633b-cd8b-45ca-ae86-1d5c759ba0d1"</span><span class="p">)</span>
<span class="n">UUID_NAMESPACE</span> <span class="o">=</span> <span class="n">uuid</span><span class="p">.</span><span class="nc">UUID</span><span class="p">(</span><span class="s">"urn:uuid:{}"</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">UUID_NAMESPACE_SEED</span><span class="p">),</span> <span class="n">version</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span></code></pre></figure>

<p>Now the data above will be converted to the following chart:</p>

<p><img src="/images/graphviz_gdc/gdc_dev_1585.png" alt="gdc_dev_1585" /></p>

<p>This is much easier for developers to analyze the data and understanding the relationships between the nodes and edges 
in the data.</p>

<p>If the above example is not strong enough. Here is another picture. With so many nodes, it will be almost impracticle to understand and remember 
all the relationships by only reading the yaml file.</p>

<p><img src="/images/graphviz_gdc/gdc_sample.png" alt="gdc_sample" /></p>

<p>This tool has made our developer work much more joyful.</p>

</div>

<div class="related">
  <h2>Related Posts</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="/2023/03/03/Download_latest_video_from_YouTube_Channel/">
            Download Latest video from YouTube channel
            <small>03 Mar 2023</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2019/11/20/The_Clean_Coder/">
            Reading The Clean Coder
            <small>20 Nov 2019</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2017/08/28/v_qq_dl-a-python-video-downloader/">
            v_qq_dl a small video downloader
            <small>28 Aug 2017</small>
          </a>
        </h3>
      </li>
    
  </ul>
</div>

      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

    <script>
      (function(document) {
        var toggle = document.querySelector('.sidebar-toggle');
        var sidebar = document.querySelector('#sidebar');
        var checkbox = document.querySelector('#sidebar-checkbox');

        document.addEventListener('click', function(e) {
          var target = e.target;

          if(!checkbox.checked ||
             sidebar.contains(target) ||
             (target === checkbox || target === toggle)) return;

          checkbox.checked = false;
        }, false);
      })(document);
    </script>
  </body>
</html>
